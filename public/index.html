<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 30px;
            text-align: center;
            display: none;
        }

        .qr-display {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #e1e1e1;
        }

        .qr-display img {
            max-width: 100%;
            height: auto;
        }

        .download-links {
            margin-top: 20px;
        }

        .download-links a {
            display: inline-block;
            margin: 5px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
        }

        .download-links a:hover {
            background: #218838;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .api-info {
            margin-top: 30px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 10px;
            font-size: 14px;
        }

        .api-info h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        .api-info code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        small {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”— QR Code Generator</h1>
        
        <form id="qrForm">
            <div class="form-group">
                <label for="url">Enter URL:</label>
                <input 
                    type="url" 
                    id="url" 
                    name="url" 
                    placeholder="https://example.com" 
                    required
                >
            </div>
            
            <div class="form-group">
                <label for="format">Format:</label>
                <select id="format" name="format">
                    <option value="png">PNG</option>
                    <option value="svg">SVG</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="size">Size (pixels):</label>
                <input 
                    type="number" 
                    id="size" 
                    name="size" 
                    value="200" 
                    min="100" 
                    max="1000" 
                    step="50"
                >
            </div>
            
            <div class="form-group">
                <label for="transparent">
                    <input 
                        type="checkbox" 
                        id="transparent" 
                        name="transparent"
                        style="margin-right: 8px; transform: scale(1.2);"
                    >
                    Transparent Background
                </label>
                <small style="display: block; color: #666; margin-top: 5px;">
                    Remove white background (works best with SVG format)
                </small>
            </div>
            
            <button type="submit">Generate QR Code</button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Generating QR Code...</p>
        </div>

        <div class="result" id="result">
            <h3>Your QR Code:</h3>
            <div class="qr-display" id="qrDisplay"></div>
            <div class="download-links" id="downloadLinks"></div>
        </div>

        <div class="api-info">
            <h3>API Usage:</h3>
            <p><strong>POST</strong> <code>/generate-qr</code> - Returns JSON with base64 QR code</p>
            <p><strong>GET</strong> <code>/qr?url=&lt;URL&gt;&amp;format=png&amp;size=200&amp;transparent=false</code> - Returns image directly</p>
            <p><strong>GET</strong> <code>/health</code> - Health check</p>
            <p><strong>Parameters:</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><code>url</code> - The URL to encode (required)</li>
                <li><code>format</code> - "png" or "svg" (optional, default: "png")</li>
                <li><code>size</code> - Size in pixels (optional, default: 200)</li>
                <li><code>transparent</code> - "true" or "false" for transparent background (optional, default: "false")</li>
            </ul>
        </div>
    </div>

    <script>
        const form = document.getElementById('qrForm');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const qrDisplay = document.getElementById('qrDisplay');
        const downloadLinks = document.getElementById('downloadLinks');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const data = {
                url: formData.get('url'),
                format: formData.get('format'),
                size: parseInt(formData.get('size')),
                transparentBackground: formData.get('transparent') === 'on'
            };

            // Show loading
            loading.style.display = 'block';
            result.style.display = 'none';
            
            // Clear previous errors
            const existingError = document.querySelector('.error');
            if (existingError) {
                existingError.remove();
            }

            try {
                const response = await fetch('/generate-qr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(responseData.message || 'Failed to generate QR code');
                }

                // Hide loading
                loading.style.display = 'none';

                // Display QR code
                if (data.format === 'png') {
                    qrDisplay.innerHTML = `<img src="${responseData.qrCode}" alt="QR Code for ${data.url}">`;
                    
                    // Create download links
                    const transparentParam = data.transparentBackground ? '&transparent=true' : '&transparent=false';
                    downloadLinks.innerHTML = `
                        <a href="${responseData.qrCode}" download="qrcode.png">Download PNG</a>
                        <a href="/qr?url=${encodeURIComponent(data.url)}&format=svg&size=${data.size}${transparentParam}" download="qrcode.svg">Download SVG</a>
                    `;
                }

                result.style.display = 'block';

            } catch (error) {
                loading.style.display = 'none';
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.textContent = error.message;
                form.appendChild(errorDiv);
            }
        });

        // Handle SVG format differently
        document.getElementById('format').addEventListener('change', (e) => {
            const downloadLinks = document.getElementById('downloadLinks');
            if (e.target.value === 'svg') {
                // For SVG, we'll use the GET endpoint directly
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = new FormData(form);
                    const url = formData.get('url');
                    const size = formData.get('size');
                    
                    if (formData.get('format') === 'svg') {
                        loading.style.display = 'block';
                        result.style.display = 'none';
                        
                        try {
                            const transparentParam = formData.get('transparent') === 'on' ? '&transparent=true' : '&transparent=false';
                            const svgUrl = `/qr?url=${encodeURIComponent(url)}&format=svg&size=${size}${transparentParam}`;
                            const response = await fetch(svgUrl);
                            
                            if (!response.ok) {
                                throw new Error('Failed to generate SVG QR code');
                            }
                            
                            const svgContent = await response.text();
                            
                            loading.style.display = 'none';
                            qrDisplay.innerHTML = svgContent;
                            
                            downloadLinks.innerHTML = `
                                <a href="${svgUrl}" download="qrcode.svg">Download SVG</a>
                                <a href="/qr?url=${encodeURIComponent(url)}&format=png&size=${size}${transparentParam}" download="qrcode.png">Download PNG</a>
                            `;
                            
                            result.style.display = 'block';
                            
                        } catch (error) {
                            loading.style.display = 'none';
                            
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'error';
                            errorDiv.textContent = error.message;
                            form.appendChild(errorDiv);
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
